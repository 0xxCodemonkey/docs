{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{417:function(e,t,r){\"use strict\";r.r(t);var a=r(42),s=Object(a.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":e.$parent.slotKey}},[r(\"h3\",{attrs:{id:\"terms\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#terms\"}},[e._v(\"#\")]),e._v(\" Terms\")]),e._v(\" \"),r(\"h4\",{attrs:{id:\"attestation-certificate\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#attestation-certificate\"}},[e._v(\"#\")]),e._v(\" Attestation Certificate\")]),e._v(\" \"),r(\"p\",[e._v(\"This is a self-signed X.509 certificate that contains a signed report by Intel, and the SGX enclave.\\nThe report contains both a report that the enclave is genuine, a code hash, and a signature of the creator of the enclave.\")]),e._v(\" \"),r(\"h4\",{attrs:{id:\"seed\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#seed\"}},[e._v(\"#\")]),e._v(\" Seed\")]),e._v(\" \"),r(\"p\",[e._v(\"this is a parameter that is shared between all enclaves on the network in order to garuantee determinisic calculations.\\nWhen a node authenticates succesfully, the network encrypts the seed and shares it with the node. Protocol internals are described \"),r(\"a\",{attrs:{href:\"https://github.com/enigmampc/SecretNetwork/blob/master/docs/protocol/encryption-specs.md\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"here\"),r(\"OutboundLink\")],1)]),e._v(\" \"),r(\"h2\",{attrs:{id:\"background\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#background\"}},[e._v(\"#\")]),e._v(\" Background\")]),e._v(\" \"),r(\"p\",[e._v(\"This section will explain node registration in the Secret Network. If you just care about installation you can just follow the setup guides and ignore this document.\\nIf, however, you want to learn more about what's going on behind the scenes here read on.\")]),e._v(\" \"),r(\"p\",[e._v(\"In order to verify that each node on the Secret Network is running a valid SGX node, we use a process that we call registration.\\nEssentially, it is the process of authenticating with the network.\")]),e._v(\" \"),r(\"p\",[r(\"strong\",[e._v(\"The process is unique and bound to the node CPU\")]),e._v(\". It needs to be performed for each node, and you cannot migrate registration parameters between nodes.\\nThe process essentially creates a binding between the processor and the blockchain node, so that they can work together.\")]),e._v(\" \"),r(\"p\",[e._v(\"For this reason, the setup will be slightly more complex than what you might be familiar with from other blockchains in the Cosmos ecosystem.\")]),e._v(\" \"),r(\"p\",[e._v(\"The registration process is made up of three main steps:\")]),e._v(\" \"),r(\"ol\",[r(\"li\",[e._v(\"Enclave verification with Intel Attestation Service - this step creates an \"),r(\"a\",{attrs:{href:\"#attestation-certificate\"}},[r(\"em\",[e._v(\"attestation certificate\")])]),e._v(\" that we will use to\\nvalidate the node\")]),e._v(\" \"),r(\"li\",[e._v(\"On-chain network verification - Broadcast of the \"),r(\"a\",{attrs:{href:\"#attestation-certificate\"}},[r(\"em\",[e._v(\"attestation certificate\")])]),e._v(\" to the network. The network will verify that\\nthe certificate is signed by Intel, and that the enclave code running is identical to what is currently running on the network.\\nThis means that running an enclave that is differs by 1 byte will be impossible.\")]),e._v(\" \"),r(\"li\",[e._v(\"Querying the network for the \"),r(\"a\",{attrs:{href:\"#seed\"}},[r(\"em\",[e._v(\"encrypted seed\")])]),e._v(\" and starting the node\")])]),e._v(\" \"),r(\"p\",[e._v(\"At the end of this process (if it is successful) the network will output an \"),r(\"em\",[e._v(\"encrypted seed\")]),e._v(\" (unique to this node), which is required for our node to start.\\nAfter decryption inside the enclave, the result is a seed that is known to all enclaves on the network, and is the source of determinism between all network nodes.\")]),e._v(\" \"),r(\"p\",[e._v(\"For a deeper dive into the protocol see the \"),r(\"a\",{attrs:{href:\"https://github.com/enigmampc/SecretNetwork/blob/master/docs/protocol/encryption-specs.md#node-startup\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"protocol documentation\"),r(\"OutboundLink\")],1)]),e._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[e._v(\"Note: Due to the way rust and C code are compiled recompilation of the enclave code is non deterministic, and will be rejected during the attestation process.\\nThis feature is refered to as a reproducable build, and is a feature that will be included in future releases.\\n\")])])]),r(\"h2\",{attrs:{id:\"prerequisites\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#prerequisites\"}},[e._v(\"#\")]),e._v(\" Prerequisites\")]),e._v(\" \"),r(\"p\",[e._v(\"To register your node, you will need:\")]),e._v(\" \"),r(\"ul\",[r(\"li\",[r(\"p\",[e._v(\"RPC address of an already active node. You can use \"),r(\"code\",[e._v(\"bootstrap.secrettestnet.io:26657\")]),e._v(\", or any other node that exposes RPC services.\")])]),e._v(\" \"),r(\"li\",[r(\"p\",[e._v(\"Account with some SCRT\")])])]),e._v(\" \"),r(\"h2\",{attrs:{id:\"instructions\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#instructions\"}},[e._v(\"#\")]),e._v(\" Instructions\")]),e._v(\" \"),r(\"h4\",{attrs:{id:\"initialize-secret-enclave\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#initialize-secret-enclave\"}},[e._v(\"#\")]),e._v(\" Initialize secret enclave\")]),e._v(\" \"),r(\"p\",[e._v(\"This will perform initialization, and remote attestation (with intel IAS). Make sure SGX is enabled and running\\nor this step might fail.\")]),e._v(\" \"),r(\"p\",[r(\"code\",[e._v(\"secretd init-enclave\")])]),e._v(\" \"),r(\"p\",[e._v(\"If \"),r(\"code\",[e._v(\"init-enclave\")]),e._v(\" was succssful, you should see \"),r(\"code\",[e._v(\"attestation_cert.der\")]),e._v(\" created. This is the \"),r(\"em\",[e._v(\"attestation certificate\")]),e._v(\" which we will\\nneed for the next step.\")]),e._v(\" \"),r(\"h4\",{attrs:{id:\"check-your-certificate-is-valid\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#check-your-certificate-is-valid\"}},[e._v(\"#\")]),e._v(\" Check your certificate is valid\")]),e._v(\" \"),r(\"p\",[r(\"code\",[e._v(\"PUBLIC_KEY=$(secretd parse attestation_cert.der 2> /dev/null | cut -c 3- )\")]),e._v(\" \"),r(\"code\",[e._v(\"echo $PUBLIC_KEY\")])]),e._v(\" \"),r(\"p\",[e._v(\"Should return your 64 character registration key if it was successful.\")]),e._v(\" \"),r(\"p\",[e._v(\"You can use the command \"),r(\"code\",[e._v(\"secretd parse <certificate_file>\")]),e._v(\" to validate the file, and print the public key of the node.\\nThis public key is what the network will use to encrypt the seed, so only your enclave can decrypt it.\")]),e._v(\" \"),r(\"p\",[e._v(\"Note: This step will locally verify the certificate only, and will not check the enclave status or the code hash of the enclave.\\nAuthetnication with the network may still fail due to either of those causes.\")]),e._v(\" \"),r(\"h4\",{attrs:{id:\"register-your-node-on-chain\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#register-your-node-on-chain\"}},[e._v(\"#\")]),e._v(\" Register your node on-chain\")]),e._v(\" \"),r(\"p\",[r(\"code\",[e._v(\"secretcli tx register auth <path/to/attestation_cert.der> --node <rpc_service> --from <your account>\")])]),e._v(\" \"),r(\"p\",[e._v(\"You can check the result of this transaction using\")]),e._v(\" \"),r(\"p\",[r(\"code\",[e._v(\"secretcli q tx <TX_HASH>\")])]),e._v(\" \"),r(\"h4\",{attrs:{id:\"get-your-encrypted-seed-from-the-network\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#get-your-encrypted-seed-from-the-network\"}},[e._v(\"#\")]),e._v(\" Get your \"),r(\"a\",{attrs:{href:\"#seed\"}},[r(\"em\",[e._v(\"encrypted seed\")])]),e._v(\" from the network\")]),e._v(\" \"),r(\"p\",[e._v(\"If the above step was successful, you should now be able to query the blockchain for your encrypted seed.\")]),e._v(\" \"),r(\"p\",[r(\"code\",[e._v('SEED=$(secretcli query register seed \"$PUBLIC_KEY\" --node <rpc_service> | cut -c 3-) echo $SEED')])]),e._v(\" \"),r(\"h4\",{attrs:{id:\"get-additional-network-parameters\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#get-additional-network-parameters\"}},[e._v(\"#\")]),e._v(\" Get additional network parameters\")]),e._v(\" \"),r(\"p\",[e._v(\"The node needs a couple of additional parameters from the network before it can start. These are used to encrypt contract inputs & outputs.\")]),e._v(\" \"),r(\"p\",[r(\"code\",[e._v(\"secretcli q register secret-network-params --node <rpc_service>\")])]),e._v(\" \"),r(\"p\",[e._v(\"This will create a couple of files in your current path, mainly \"),r(\"code\",[e._v(\"node-master-cert.der\")])]),e._v(\" \"),r(\"h4\",{attrs:{id:\"configure-your-local-node\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#configure-your-local-node\"}},[e._v(\"#\")]),e._v(\" Configure your local node\")]),e._v(\" \"),r(\"p\",[e._v(\"Since the previous command was ran only using the \"),r(\"code\",[e._v(\"secretcli\")]),e._v(\" we must now run a final command to load all our startup parameters to \"),r(\"code\",[e._v(\"secretd\")])]),e._v(\" \"),r(\"p\",[r(\"code\",[e._v('secretd configure-secret node-master-cert.der \"$SEED\"')])])])}),[],!1,null,null,null);t.default=s.exports}}]);","extractedComments":[]}