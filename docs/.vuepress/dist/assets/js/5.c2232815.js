(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{302:function(t,e,a){t.exports=a.p+"assets/img/secretcli_keys_list.3418ae8c.png"},318:function(t,e,a){t.exports=a.p+"assets/img/docker-run.a9b0e42d.png"},368:function(t,e,a){"use strict";a.r(e);var s=a(42),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"secret-contract-dev-guide"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#secret-contract-dev-guide"}},[t._v("#")]),t._v(" Secret Contract Dev Guide")]),t._v(" "),s("p",[t._v("This repository can be used to get up and running on a local Secret Network developer testnet (secretdev) to start working with CosmWasm-based smart contracts (soon to be Secret Contracts).")]),t._v(" "),s("p",[t._v("A few important notes:")]),t._v(" "),s("ul",[s("li",[t._v("smart contracts in this repo are a precursor to Secret Contracts, which enable data privacy")]),t._v(" "),s("li",[t._v("smart contracts are written in Rust and based on CosmWasm, and the module is referred to as "),s("code",[t._v("compute")]),t._v(" in the Secret Network")]),t._v(" "),s("li",[t._v("these CosmWasm-based smart contracts should be reusable and easily modified once we incorporate data privacy")])]),t._v(" "),s("h2",{attrs:{id:"setup-the-local-developer-testnet"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#setup-the-local-developer-testnet"}},[t._v("#")]),t._v(" Setup the Local Developer Testnet")]),t._v(" "),s("p",[t._v("The developer blockchain is configured to run inside a docker container. Install "),s("a",{attrs:{href:"https://docs.docker.com/install/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker"),s("OutboundLink")],1),t._v(" for your environment (Mac, Windows, Linux).")]),t._v(" "),s("p",[t._v("Open a terminal window and change to your project directory.\nThen start SecretNetwork, labelled "),s("em",[t._v("secretdev")]),t._v(" from here on:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("$ docker run -it --rm \\\n -p 26657:26657 -p 26656:26656 -p 1317:1317 \\\n --name secretdev enigmampc/secret-network-bootstrap-sw:latest\n")])])]),s("p",[s("strong",[t._v("NOTE")]),t._v(": The "),s("em",[t._v("secretdev")]),t._v(" docker container can be stopped by CTRL+C")]),t._v(" "),s("p",[s("img",{attrs:{src:a(318),alt:""}})]),t._v(" "),s("p",[t._v("At this point you're running a local SecretNetwork full-node. Let's connect to the container so we can view and manage the secret keys:")]),t._v(" "),s("p",[s("strong",[t._v("NOTE")]),t._v(": In a new terminal")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker exec -it secretdev /bin/bash\n")])])]),s("p",[t._v("The local blockchain has a couple of keys setup for you (similar to accounts if you're familiar with Truffle Ganache). The keys are stored in the "),s("code",[t._v("test")]),t._v(" keyring backend, which makes it easier for local development and testing.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("secretcli keys list --keyring-backend test\n")])])]),s("p",[s("img",{attrs:{src:a(302),alt:""}})]),t._v(" "),s("p",[s("code",[t._v("exit")]),t._v(" when you are done")]),t._v(" "),s("h2",{attrs:{id:"setup-secret-contracts-cosmwasm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#setup-secret-contracts-cosmwasm"}},[t._v("#")]),t._v(" Setup Secret Contracts (CosmWasm)")]),t._v(" "),s("p",[t._v("Secret Contracts are based on "),s("a",{attrs:{href:"https://www.cosmwasm.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("CosmWasm"),s("OutboundLink")],1),t._v(" which is implementated on various Cosmos SDK blockchains. The CosmWasm smart contracts are like Ethereum's smart contracts except they can be used on other networks using the "),s("a",{attrs:{href:"https://cosmos.network/ibc",target:"_blank",rel:"noopener noreferrer"}},[t._v("Inter-Blockchain Protocol"),s("OutboundLink")],1),t._v(" (IBC). CosmWasm smart contracts are written in the Rust language.")]),t._v(" "),s("p",[t._v("The Secret Network has a "),s("em",[t._v("compute")]),t._v(" module that we'll use to store, query and instantiate the smart contract. Once stored on the blockchain the smart contract has to be created (or instantiated) in order to execute its methods. This is similar to doing an Ethereum "),s("code",[t._v("migrate")]),t._v(" using truffle which handles the deployment and creation of a smart contract.")]),t._v(" "),s("p",[t._v("Eventually the smart contracts will become Secret Contracts (in a future blockchain upgrade) running in an SGX enclave (Trusted Execution Environment) where computations are performed on the encrypted contract data (i.e. inputs, state).")]),t._v(" "),s("p",[t._v("Next we'll walkthrough steps to:")]),t._v(" "),s("ul",[s("li",[t._v("install Rust")]),t._v(" "),s("li",[t._v("install the Rust dependencies")]),t._v(" "),s("li",[t._v("create your first project")])]),t._v(" "),s("p",[t._v("The Rust dependencies include the Rust compiler, cargo ("),s("em",[t._v("package manager")]),t._v("), toolchain and a package to generate projects. You can check out the Rust book, rustlings course, examples and more "),s("a",{attrs:{href:"https://www.rust-lang.org/learn",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("ol",[s("li",[t._v("Install Rust")])]),t._v(" "),s("p",[t._v("More information about installing Rust can be found here: https://www.rust-lang.org/tools/install.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh\nsource $HOME/.cargo/env\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("Add rustup target wasm32 for both stable and nightly")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("rustup default stable\nrustup target list --installed\nrustup target add wasm32-unknown-unknown\n\nrustup install nightly\nrustup target add wasm32-unknown-unknown --toolchain nightly\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("If using linux, install the standard build tools:")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("apt install build-essential\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("Run cargo install cargo-generate")])]),t._v(" "),s("p",[s("a",{attrs:{href:"https://doc.rust-lang.org/cargo",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cargo generate"),s("OutboundLink")],1),t._v(" is the tool you'll use to create a smart contract project.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("cargo install cargo-generate --features vendored-openssl\n")])])]),s("h2",{attrs:{id:"create-initial-smart-contract"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#create-initial-smart-contract"}},[t._v("#")]),t._v(" Create Initial Smart Contract")]),t._v(" "),s("p",[t._v("To create the smart contract you'll:")]),t._v(" "),s("ul",[s("li",[t._v("generate the initial project")]),t._v(" "),s("li",[t._v("compile the smart contract")]),t._v(" "),s("li",[t._v("run unit tests")]),t._v(" "),s("li",[t._v("optimize the wasm contract bytecode to prepare for deployment")]),t._v(" "),s("li",[t._v("deploy the smart contract to your local SecretNetwork")]),t._v(" "),s("li",[t._v("instantiate it with contract parameters")])]),t._v(" "),s("p",[t._v("Generate the smart contract project")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("cargo generate --git https://github.com/enigmampc/secret-template --name mysimplecounter\n")])])]),s("p",[t._v("The git project above is a cosmwasm smart contract template that implements a simple counter. The contract is created with a parameter for the initial count and allows subsequent incrementing.")]),t._v(" "),s("p",[t._v("Change directory to the project you created and view the structure and files that were created.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("cd mysimplecounter\n")])])]),s("p",[t._v("The generate creates a directory with the project name and has this structure:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Cargo.lock\tDeveloping.md\tLICENSE\t\tPublishing.md\texamples\tschema\t\ttests\nCargo.toml\tImporting.md\tNOTICE\t\tREADME.md\trustfmt.toml\tsrc\n")])])]),s("h2",{attrs:{id:"compile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#compile"}},[t._v("#")]),t._v(" Compile")]),t._v(" "),s("p",[t._v("Use the following command to compile the smart contract which produces the wasm contract file.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("cargo wasm\n")])])]),s("h2",{attrs:{id:"unit-tests-nb-tests-in-this-template-currently-fail-unless-you-have-sgx-enabled"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#unit-tests-nb-tests-in-this-template-currently-fail-unless-you-have-sgx-enabled"}},[t._v("#")]),t._v(" Unit Tests (NB Tests in this template currently fail unless you have SGX enabled)")]),t._v(" "),s("p",[t._v("Run unit tests")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("RUST_BACKTRACE=1 cargo unit-test\n")])])]),s("h2",{attrs:{id:"integration-tests"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#integration-tests"}},[t._v("#")]),t._v(" Integration Tests")]),t._v(" "),s("p",[t._v("The integration tests are under the "),s("code",[t._v("tests/")]),t._v(" directory and run as:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("cargo integration-test\n")])])]),s("h2",{attrs:{id:"generate-msg-schemas"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#generate-msg-schemas"}},[t._v("#")]),t._v(" Generate Msg Schemas")]),t._v(" "),s("p",[t._v("We can also generate JSON Schemas that serve as a guide for anyone trying to use the contract, to specify which arguments they need.")]),t._v(" "),s("p",[t._v("Auto-generate msg schemas (when changed):")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("cargo schema\n")])])]),s("h2",{attrs:{id:"deploy-smart-contract"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deploy-smart-contract"}},[t._v("#")]),t._v(" Deploy Smart Contract")]),t._v(" "),s("p",[t._v("Before deploying or storing the contract on the testnet, need to run the cosmwasm optimizer.")]),t._v(" "),s("h3",{attrs:{id:"optimize-compiled-wasm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#optimize-compiled-wasm"}},[t._v("#")]),t._v(" Optimize compiled wasm")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('docker run --rm -v "$(pwd)":/code \\\n  --mount type=volume,source="$(basename "$(pwd)")_cache",target=/code/target \\\n  --mount type=volume,source=registry_cache,target=/usr/local/cargo/registry \\\n  cosmwasm/rust-optimizer:0.8.0\n')])])]),s("p",[t._v("The contract wasm needs to be optimized to get a smaller footprint. Cosmwasm notes state the contract would be too large for the blockchain unless optimized. This example contract.wasm is 1.8M before optimizing, 90K after.")]),t._v(" "),s("p",[t._v("The optimization creates two files:")]),t._v(" "),s("ul",[s("li",[t._v("contract.wasm")]),t._v(" "),s("li",[t._v("hash.txt")])]),t._v(" "),s("h3",{attrs:{id:"store-the-smart-contract-on-our-local-testnet"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#store-the-smart-contract-on-our-local-testnet"}},[t._v("#")]),t._v(" Store the Smart Contract on our local Testnet")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# First lets start it up again, this time mounting our project's code inside the container.\ndocker run -it --rm \\\n -p 26657:26657 -p 26656:26656 -p 1317:1317 \\\n -v $(pwd):/root/code \\\n --name secretdev enigmampc/secret-network-bootstrap-sw:latest\n")])])]),s("p",[t._v("Upload the optimized contract.wasm to "),s("em",[t._v("secretdev")]),t._v(" :")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker exec -it secretdev /bin/bash\n\ncd code\n\nsecretcli tx compute store contract.wasm --from a --gas auto -y --keyring-backend test\n")])])]),s("h3",{attrs:{id:"querying-the-smart-contract-and-code"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#querying-the-smart-contract-and-code"}},[t._v("#")]),t._v(" Querying the Smart Contract and Code")]),t._v(" "),s("p",[t._v("List current smart contract code")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('secretcli query compute list-code\n[\n  {\n    "id": 1,\n    "creator": "enigma1klqgym9m7pcvhvgsl8mf0elshyw0qhruy4aqxx",\n    "data_hash": "0C667E20BA2891536AF97802E4698BD536D9C7AB36702379C43D360AD3E40A14",\n    "source": "",\n    "builder": ""\n  }\n]\n')])])]),s("h3",{attrs:{id:"instantiate-the-smart-contract"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#instantiate-the-smart-contract"}},[t._v("#")]),t._v(" Instantiate the Smart Contract")]),t._v(" "),s("p",[t._v("At this point the contract's been uploaded and stored on the testnet, but there's no \"instance.\"\nThis is like "),s("code",[t._v("discovery migrate")]),t._v(" which handles both the deploying and creation of the contract instance, except in Cosmos the deploy-execute process consists of 3 steps rather than 2 in Ethereum. You can read more about the logic behind this decision, and other comparisons to Solidity, in the "),s("a",{attrs:{href:"https://www.cosmwasm.com/docs/getting-started/smart-contracts",target:"_blank",rel:"noopener noreferrer"}},[t._v("cosmwasm documentation"),s("OutboundLink")],1),t._v(". These steps are:")]),t._v(" "),s("ol",[s("li",[t._v("Upload Code - Upload some optimized wasm code, no state nor contract address (example Standard ERC20 contract)")]),t._v(" "),s("li",[t._v("Instantiate Contract - Instantiate a code reference with some initial state, creates new address (example set token name, max issuance, etc for my ERC20 token)")]),t._v(" "),s("li",[t._v("Execute Contract - This may support many different calls, but they are all unprivileged usage of a previously instantiated contract, depends on the contract design (example: Send ERC20 token, grant approval to other contract)")])]),t._v(" "),s("p",[t._v("To create an instance of this project we must also provide some JSON input data, a starting count.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("INIT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{'),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),t._v("count"),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),t._v(': 100000000}"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CODE_ID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nsecretcli tx compute instantiate "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$CODE_ID")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$INIT")]),t._v('"')]),t._v(" --from a --label "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my counter"')]),t._v(" -y --keyring-backend "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v("\n")])])]),s("p",[t._v("With the contract now initialized, we can find its address")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("secretcli query compute list-contract-by-code "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])]),s("p",[t._v("Our instance is secret18vd8fpwxzck93qlwghaj6arh4p7c5n8978vsyg")]),t._v(" "),s("p",[t._v("We can query the contract state")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CONTRACT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("secret18vd8fpwxzck93qlwghaj6arh4p7c5n8978vsyg\nsecretcli query compute contract-state smart "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$CONTRACT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{'),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),t._v("get_count"),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),t._v(': {}}"')]),t._v("\n")])])]),s("p",[t._v("And we can increment our counter")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("secretcli tx compute execute "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$CONTRACT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{'),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),t._v("increment"),s("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[t._v('\\"')]),t._v(': {}}"')]),t._v(" --from a --keyring-backend "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v("\n")])])]),s("h2",{attrs:{id:"smart-contract"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#smart-contract"}},[t._v("#")]),t._v(" Smart Contract")]),t._v(" "),s("h3",{attrs:{id:"project-structure"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#project-structure"}},[t._v("#")]),t._v(" Project Structure")]),t._v(" "),s("p",[t._v("The source directory ("),s("code",[t._v("src/")]),t._v(") has these files:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("contract.rs  lib.rs  msg.rs  state.rs\n")])])]),s("p",[t._v("The developer modifies "),s("code",[t._v("contract.rs")]),t._v(" for contract logic, contract entry points are "),s("code",[t._v("init")]),t._v(", "),s("code",[t._v("handle")]),t._v(" and "),s("code",[t._v("query")]),t._v(" functions.")]),t._v(" "),s("p",[s("code",[t._v("init")]),t._v(" in the Counter contract initializes the storage, specifically the current count and the signer/owner of the instance being initialized.")]),t._v(" "),s("p",[t._v("We also define "),s("code",[t._v("handle")]),t._v(", a generic handler for all functions writing to storage, the counter can be incremented and reset. These functions are provided the storage and the environment, the latter's used by the "),s("code",[t._v("reset")]),t._v(" function to compare the signer with the contract owner.")]),t._v(" "),s("p",[t._v("Finally we have "),s("code",[t._v("query")]),t._v(" for all functions reading state, we only have "),s("code",[t._v("query_count")]),t._v(", returning the counter state.")]),t._v(" "),s("p",[t._v("The rest of the contract file is unit tests so you can confidently change the contract logic.")]),t._v(" "),s("p",[t._v("The "),s("code",[t._v("state.rs")]),t._v(" file defines the State struct, used for storing the contract data, the only information persisted between multiple contract calls.")]),t._v(" "),s("p",[t._v("The "),s("code",[t._v("msg.rs")]),t._v(" file is where the InitMsg parameters are specified (like a constructor), the types of Query (GetCount) and Handle"),s("a",{attrs:{href:"Increment"}},[t._v("r")]),t._v(" messages, and any custom structs for each query response.")]),t._v(" "),s("div",{staticClass:"language-rs extra-class"},[s("pre",{pre:!0,attrs:{class:"language-rs"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" schemars"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("JsonSchema"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" serde"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Deserialize"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Serialize"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[t._v("#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pub")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" InitMsg "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pub")]),t._v(" count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" i32"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[t._v("#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[t._v('#[serde(rename_all = "lowercase")]')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pub")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("enum")]),t._v(" HandleMsg "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    Increment "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    Reset "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" i32 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[t._v("#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[t._v('#[serde(rename_all = "lowercase")]')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pub")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("enum")]),t._v(" QueryMsg "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// GetCount returns the current count as a json-encoded number")]),t._v("\n    GetCount "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// We define a custom struct for each query response")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[t._v("#[derive(Serialize, Deserialize, Clone, Debug, PartialEq, JsonSchema)]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pub")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" CountResponse "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pub")]),t._v(" count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" i32"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("h3",{attrs:{id:"unit-tests"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#unit-tests"}},[t._v("#")]),t._v(" Unit Tests")]),t._v(" "),s("p",[t._v("Unit tests are coded in the "),s("code",[t._v("contract.rs")]),t._v(" file itself:")]),t._v(" "),s("div",{staticClass:"language-rs extra-class"},[s("pre",{pre:!0,attrs:{class:"language-rs"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[t._v("#[cfg(test)]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mod")]),t._v(" tests "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" cosmwasm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("errors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("Error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" cosmwasm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("mock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("dependencies"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mock_env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" cosmwasm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("serde"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("from_slice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" cosmwasm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("types"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("coin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token attribute attr-name"}},[t._v("#[test]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fn")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("proper_initialization")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mut")]),t._v(" deps "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dependencies")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" msg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" InitMsg "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" env "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mock_env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("deps"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"creator"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("coin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1000"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"earth"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// we can just call .unwrap() to assert this was a success")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" res "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mut")]),t._v(" deps"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" msg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unwrap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("assert_eq!")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("messages"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// it worked, let's query the state")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" res "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("deps"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" QueryMsg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("::")]),t._v("GetCount "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unwrap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CountResponse "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("from_slice")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unwrap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("assert_eq!")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"resources"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#resources"}},[t._v("#")]),t._v(" Resources")]),t._v(" "),s("p",[t._v("Smart Contracts on the Secret Network use cosmwasm. Therefore, for troubleshooting and additional context, cosmwasm documentation may be very useful. Here are some of the links we relied on in putting together this guide:")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/CosmWasm/cosmwasm",target:"_blank",rel:"noopener noreferrer"}},[t._v("cosmwasm repo"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/CosmWasm/cosmwasm-template",target:"_blank",rel:"noopener noreferrer"}},[t._v("cosmwasm starter pack - project template"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.cosmwasm.com/docs/getting-started/using-the-sdk",target:"_blank",rel:"noopener noreferrer"}},[t._v('Setting up a local "testnet"'),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.cosmwasm.com/docs/intro/overview",target:"_blank",rel:"noopener noreferrer"}},[t._v("cosmwasm docs"),s("OutboundLink")],1)])]),t._v(" "),s("h1",{attrs:{id:"what-s-next"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#what-s-next"}},[t._v("#")]),t._v(" What's next?")]),t._v(" "),s("ul",[s("li",[s("RouterLink",{attrs:{to:"/dev/cosmwasm-js.html"}},[t._v("CosmWasm JS")])],1),t._v(" "),s("li",[s("RouterLink",{attrs:{to:"/dev/frontend.html"}},[t._v("Frontend development")])],1)])])}),[],!1,null,null,null);e.default=n.exports}}]);